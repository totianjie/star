layui.define(["layer","form"],function(z){var f=layui.jquery,y=layui.layer,d=layui.form(),o=layui.hint(),s=layui.device(),k="layedit",j="layui-this",e="layui-show",a="layui-disabled",w=function(){var A=this;A.index=0;A.config={tool:["strong","italic","underline","del","|","left","center","right","|","link","unlink","face","image"],hideTool:[],height:280}};w.prototype.set=function(A){var B=this;f.extend(true,B.config,A);return B};w.prototype.on=function(A,B){return layui.onevent(k,A,B)};w.prototype.build=function(B,G){G=G||{};var J=this,E=J.config,D="layui-layedit",C=f("#"+B),A="LAY_layedit_"+(++J.index),F=C.next("."+D),K=f.extend({},E,G),I=function(){var L=[],M={};layui.each(K.hideTool,function(N,O){M[O]=true});layui.each(K.tool,function(N,O){if(u[O]&&!M[O]){L.push(u[O])}});return L.join("")}(),H=f(['<div class="'+D+'">','<div class="layui-unselect layui-layedit-tool">'+I+"</div>",'<div class="layui-layedit-iframe">','<iframe id="'+A+'" name="'+A+'" textarea="'+B+'" frameborder="0"></iframe>',"</div>","</div>"].join(""));if(s.ie&&s.ie<8){return C.removeClass("layui-hide").addClass(e)}F[0]&&(F.remove());c.call(J,H,C[0],K);C.addClass("layui-hide").after(H);return J.index};w.prototype.getContent=function(A){var B=q(A);if(!B[0]){return}return h(B[0].document.body.innerHTML)};w.prototype.getText=function(A){var B=q(A);if(!B[0]){return}return f(B[0].document.body).text()};w.prototype.sync=function(B){var C=q(B);if(!C[0]){return}var A=f("#"+C[1].attr("textarea"));A.val(h(C[0].document.body.innerHTML))};w.prototype.getSelection=function(B){var C=q(B);if(!C[0]){return}var A=t(C[0].document);return document.selection?A.text:A.toString()};var c=function(B,D,E){var C=this,A=B.find("iframe");A.css({height:E.height}).on("load",function(){var G=A.contents(),J=A.prop("contentWindow"),H=G.find("head"),I=f(["<style>","*{margin: 0; padding: 0;}","body{padding: 10px; line-height: 20px; overflow-x: hidden; word-wrap: break-word; font: 14px Helvetica Neue,Helvetica,PingFang SC,Microsoft YaHei,Tahoma,Arial,sans-serif; -webkit-box-sizing: border-box !important; -moz-box-sizing: border-box !important; box-sizing: border-box !important;}","a{color:#01AAED; text-decoration:none;}a:hover{color:#c00}","p{margin-bottom: 10px;}","img{display: inline-block; border: none; vertical-align: middle;}","pre{margin: 10px 0; padding: 10px; line-height: 20px; border: 1px solid #ddd; border-left-width: 6px; background-color: #F2F2F2; color: #333; font-family: Courier New; font-size: 12px;}","</style>"].join("")),F=G.find("body");H.append(I);F.attr("contenteditable","true").css({"min-height":E.height}).html(D.value||"");m.apply(C,[J,A,D,E]);n.call(C,J,B,E)})},q=function(A){var B=f("#LAY_layedit_"+A),C=B.prop("contentWindow");return[C,B]},h=function(A){if(s.ie==8){A=A.replace(/<.+>/g,function(B){return B.toLowerCase()})}return A},m=function(E,C,D,F){var B=E.document,A=f(B.body);A.on("keydown",function(K){var H=K.keyCode;if(H===13){var J=t(B);var I=r(J),G=I.parentNode;if(G.tagName.toLowerCase()==="pre"){if(K.shiftKey){return}y.msg("请暂时用shift+enter");return false}B.execCommand("formatBlock",false,"<p>")}});f(D).parents("form").on("submit",function(){var G=A.html();if(s.ie==8){G=G.replace(/<.+>/g,function(H){return H.toLowerCase()})}D.value=G});A.on("paste",function(G){B.execCommand("formatBlock",false,"<p>");setTimeout(function(){l.call(E,A);D.value=A.html()},100)})},l=function(B){var C=this,A=C.document;B.find("*[style]").each(function(){var D=this.style.textAlign;this.removeAttribute("style");f(this).css({"text-align":D||""})});B.find("table").addClass("layui-table");B.find("script,link").remove()},t=function(A){return A.selection?A.selection.createRange():A.getSelection().getRangeAt(0)},r=function(A){return A.endContainer||A.parentElement().childNodes[0]},v=function(E,B,C){var A=this.document,F=document.createElement(E);for(var D in B){F.setAttribute(D,B[D])}F.removeAttribute("text");if(A.selection){var G=C.text||B.text;if(E==="a"&&!G){return}if(G){F.innerHTML=G}C.pasteHTML(f(F).prop("outerHTML"));C.select()}else{var G=C.toString()||B.text;if(E==="a"&&!G){return}if(G){F.innerHTML=G}C.deleteContents();C.insertNode(F)}},x=function(F,E){var A=this.document,C="layedit-tool-active",B=r(t(A)),D=function(G){return F.find(".layedit-tool-"+G)};if(E){E[E.hasClass(C)?"removeClass":"addClass"](C)}F.find(">i").removeClass(C);D("unlink").addClass(a);f(B).parents().each(function(){var H=this.tagName.toLowerCase(),G=this.style.textAlign;if(H==="b"||H==="strong"){D("b").addClass(C)}if(H==="i"||H==="em"){D("i").addClass(C)}if(H==="u"){D("u").addClass(C)}if(H==="strike"){D("d").addClass(C)}if(H==="p"){if(G==="center"){D("center").addClass(C)}else{if(G==="right"){D("right").addClass(C)}else{D("left").addClass(C)}}}if(H==="a"){D("link").addClass(C);D("unlink").removeClass(a)}})},n=function(B,E,G){var F=B.document,D=f(F.body),A={link:function(L){var K=r(L),J=f(K).parent();g.call(D,{href:J.attr("href"),target:J.attr("target")},function(N){var M=J[0];if(M.tagName==="A"){M.href=N.url}else{v.call(B,"a",{target:N.target,href:N.url,text:N.url},L)}})},unlink:function(J){F.execCommand("unlink")},face:function(J){i.call(this,function(K){v.call(B,"img",{src:K.src,alt:K.alt},J)})},image:function(J){var K=this;layui.use("upload",function(L){var M=G.uploadImage||{};L({url:M.url,method:M.type,elem:f(K).find("input")[0],unwrap:true,success:function(N){if(N.code==0){N.data=N.data||{};v.call(B,"img",{src:N.data.src,alt:N.data.title},J)}else{y.msg(N.msg||"上传失败")}}})})},code:function(J){b.call(D,function(K){v.call(B,"pre",{text:K.code,"lay-lang":K.lang},J)})},help:function(){y.open({type:2,title:"帮助",area:["600px","380px"],shadeClose:true,shade:0.1,skin:"layui-layer-msg",content:["http://www.layui.com/about/layedit/help.html","no"]})}},C=E.find(".layui-layedit-tool"),I=function(){var M=f(this),L=M.attr("layedit-event"),N=M.attr("lay-command");if(M.hasClass(a)){return}D.focus();var K=t(F),J=K.commonAncestorContainer;if(N){F.execCommand(N);if(/justifyLeft|justifyCenter|justifyRight/.test(N)){F.execCommand("formatBlock",false,"<p>")}setTimeout(function(){D.focus()},10)}else{A[L]&&A[L].call(this,K)}x.call(B,C,M)},H=/image/;C.find(">i").on("mousedown",function(){var K=f(this),J=K.attr("layedit-event");if(H.test(J)){return}I.call(this)}).on("click",function(){var K=f(this),J=K.attr("layedit-event");if(!H.test(J)){return}I.call(this)});D.on("click",function(){x.call(B,C);y.close(i.index)})},g=function(C,D){var A=this,B=y.open({type:1,id:"LAY_layedit_link",area:"350px",shade:0.05,shadeClose:true,moveType:1,title:"超链接",skin:"layui-layer-msg",content:['<ul class="layui-form" style="margin: 15px;">','<li class="layui-form-item">','<label class="layui-form-label" style="width: 60px;">URL</label>','<div class="layui-input-block" style="margin-left: 90px">','<input name="url" lay-verify="url" value="'+(C.href||"")+'" autofocus="true" autocomplete="off" class="layui-input">',"</div>","</li>",'<li class="layui-form-item">','<label class="layui-form-label" style="width: 60px;">打开方式</label>','<div class="layui-input-block" style="margin-left: 90px">','<input type="radio" name="target" value="_self" class="layui-input" title="当前窗口"'+((C.target==="_self"||!C.target)?"checked":"")+">",'<input type="radio" name="target" value="_blank" class="layui-input" title="新窗口" '+(C.target==="_blank"?"checked":"")+">","</div>","</li>",'<li class="layui-form-item" style="text-align: center;">','<button type="button" lay-submit lay-filter="layedit-link-yes" class="layui-btn"> 确定 </button>','<button style="margin-left: 20px;" type="button" class="layui-btn layui-btn-primary"> 取消 </button>',"</li>","</ul>"].join(""),success:function(E,G){var F="submit(layedit-link-yes)";d.render("radio");E.find(".layui-btn-primary").on("click",function(){y.close(G);A.focus()});d.on(F,function(H){y.close(g.index);D&&D(H.field)})}});g.index=B},i=function(B){var A=function(){var D=["[微笑]","[嘻嘻]","[哈哈]","[可爱]","[可怜]","[挖鼻]","[吃惊]","[害羞]","[挤眼]","[闭嘴]","[鄙视]","[爱你]","[泪]","[偷笑]","[亲亲]","[生病]","[太开心]","[白眼]","[右哼哼]","[左哼哼]","[嘘]","[衰]","[委屈]","[吐]","[哈欠]","[抱抱]","[怒]","[疑问]","[馋嘴]","[拜拜]","[思考]","[汗]","[困]","[睡]","[钱]","[失望]","[酷]","[色]","[哼]","[鼓掌]","[晕]","[悲伤]","[抓狂]","[黑线]","[阴险]","[怒骂]","[互粉]","[心]","[伤心]","[猪头]","[熊猫]","[兔子]","[ok]","[耶]","[good]","[NO]","[赞]","[来]","[弱]","[草泥马]","[神马]","[囧]","[浮云]","[给力]","[围观]","[威武]","[奥特曼]","[礼物]","[钟]","[话筒]","[蜡烛]","[蛋糕]"],C={};layui.each(D,function(E,F){C[F]=layui.cache.dir+"images/face/"+E+".gif"});return C}();i.hide=i.hide||function(C){if(f(C.target).attr("layedit-event")!=="face"){y.close(i.index)}};return i.index=y.tips(function(){var C=[];layui.each(A,function(D,E){C.push('<li title="'+D+'"><img src="'+E+'" alt="'+D+'"></li>')});return'<ul class="layui-clear">'+C.join("")+"</ul>"}(),this,{tips:1,time:0,skin:"layui-box layui-util-face",maxWidth:500,success:function(C,D){C.css({marginTop:-4,marginLeft:-10}).find(".layui-clear>li").on("click",function(){B&&B({src:A[this.title],alt:this.title});y.close(D)});f(document).off("click",i.hide).on("click",i.hide)}})},b=function(C){var A=this,B=y.open({type:1,id:"LAY_layedit_code",area:"550px",shade:0.05,shadeClose:true,moveType:1,title:"插入代码",skin:"layui-layer-msg",content:['<ul class="layui-form layui-form-pane" style="margin: 15px;">','<li class="layui-form-item">','<label class="layui-form-label">请选择语言</label>','<div class="layui-input-block">','<select name="lang">','<option value="JavaScript">JavaScript</option>','<option value="HTML">HTML</option>','<option value="CSS">CSS</option>','<option value="Java">Java</option>','<option value="PHP">PHP</option>','<option value="C#">C#</option>','<option value="Python">Python</option>','<option value="Ruby">Ruby</option>','<option value="Go">Go</option>',"</select>","</div>","</li>",'<li class="layui-form-item layui-form-text">','<label class="layui-form-label">代码</label>','<div class="layui-input-block">','<textarea name="code" lay-verify="required" autofocus="true" class="layui-textarea" style="height: 200px;"></textarea>',"</div>","</li>",'<li class="layui-form-item" style="text-align: center;">','<button type="button" lay-submit lay-filter="layedit-code-yes" class="layui-btn"> 确定 </button>','<button style="margin-left: 20px;" type="button" class="layui-btn layui-btn-primary"> 取消 </button>',"</li>","</ul>"].join(""),success:function(D,F){var E="submit(layedit-code-yes)";d.render("select");D.find(".layui-btn-primary").on("click",function(){y.close(F);A.focus()});d.on(E,function(G){y.close(b.index);C&&C(G.field)})}});b.index=B},u={html:'<i class="layui-icon layedit-tool-html" title="HTML源代码" lay-command="html" layedit-event="html"">&#xe64b;</i><span class="layedit-tool-mid"></span>',strong:'<i class="layui-icon layedit-tool-b" title="加粗" lay-command="Bold" layedit-event="b"">&#xe62b;</i>',italic:'<i class="layui-icon layedit-tool-i" title="斜体" lay-command="italic" layedit-event="i"">&#xe644;</i>',underline:'<i class="layui-icon layedit-tool-u" title="下划线" lay-command="underline" layedit-event="u"">&#xe646;</i>',del:'<i class="layui-icon layedit-tool-d" title="删除线" lay-command="strikeThrough" layedit-event="d"">&#xe64f;</i>',"|":'<span class="layedit-tool-mid"></span>',left:'<i class="layui-icon layedit-tool-left" title="左对齐" lay-command="justifyLeft" layedit-event="left"">&#xe649;</i>',center:'<i class="layui-icon layedit-tool-center" title="居中对齐" lay-command="justifyCenter" layedit-event="center"">&#xe647;</i>',right:'<i class="layui-icon layedit-tool-right" title="右对齐" lay-command="justifyRight" layedit-event="right"">&#xe648;</i>',link:'<i class="layui-icon layedit-tool-link" title="插入链接" layedit-event="link"">&#xe64c;</i>',unlink:'<i class="layui-icon layedit-tool-unlink layui-disabled" title="清除链接" lay-command="unlink" layedit-event="unlink"">&#xe64d;</i>',face:'<i class="layui-icon layedit-tool-face" title="表情" layedit-event="face"">&#xe650;</i>',image:'<i class="layui-icon layedit-tool-image" title="图片" layedit-event="image">&#xe64a;<input type="file" name="file"></i>',code:'<i class="layui-icon layedit-tool-code" title="插入代码" layedit-event="code">&#xe64e;</i>',help:'<i class="layui-icon layedit-tool-help" title="帮助" layedit-event="help">&#xe607;</i>'},p=new w();z(k,p)});